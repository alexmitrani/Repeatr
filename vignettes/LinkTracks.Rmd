---
title: "Link Tracks"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Link Tracks}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.width=7,
  fig.height=5,
  comment = "#>"
)
```

```{r, include = FALSE}
library(Repeatr)
```

## Introduction

A series of brief explorations of the Fugazi Live Series data.  

## What was Fugazi's biggest show?  

```{r}
attendancedata <- othervariables %>%
  filter(is.na(attendance)==FALSE) %>%
  mutate(attendance = as.integer(attendance)) %>%
  mutate(date = as.Date(date, "%d-%m-%Y")) %>%
  mutate(year = lubridate::year(date)) %>%
  select(year, date, venue, attendance)

maxattendance <- max(attendancedata$attendance)

maxattendance

attendancedata %>%
  filter(attendance == maxattendance)
```
The biggest show was the [Food Not Bombs 20th Anniversary](https://www.dischord.com/fugazi_live_series/san-francisco-ca-usa-60400) on the 4th of June 2000 at Mission Dolores Park in San Francisco, with an estimated attendance of 15000 people.  It seems that the show was recorded but it is not available yet as part of the Fugazi Live Series.  [There is a video of the show on youtube](https://www.youtube.com/watch?v=0qYvHzS7v-Q). 

## What was Fugazi's longest tour?  

```{r}

medianattendance <- othervariables %>%
  mutate(tour = ifelse(is.na(tour)==TRUE,"Unknown",tour)) %>%
  filter(is.na(attendance)==FALSE) %>%
  group_by(tour) %>%
  summarise(medianattendance = median(attendance)) %>%
  ungroup()

toursdata <- othervariables %>%
  mutate(tour = ifelse(is.na(tour)==TRUE,"Unknown",tour)) %>%
  left_join(medianattendance) %>%
  mutate(attendance = ifelse(is.na(attendance)==TRUE,medianattendance,attendance)) %>%
  group_by(tour) %>%
  filter(is.na(date)==FALSE) %>%
  summarise(start = min(date), end = max(date), shows = n(), duration = as.numeric((end - start)), attendance=sum(attendance)) %>%
  ungroup() %>%
  arrange(desc(shows))

  toursdata <- toursdata %>%
    mutate(meanattendance = as.integer(attendance / shows)) %>%
    arrange(start)

  toursdata <- toursdata %>%
    mutate(start = as.Date(start, "%d-%m-%Y")) %>%
    mutate(end = as.Date(end, "%d-%m-%Y"))

  toursdata$startyear <- lubridate::year(toursdata$start)
  toursdata$endyear <- lubridate::year(toursdata$end)

  toursdata$duration <- as.integer(toursdata$duration)
  toursdata$attendance <- as.integer(toursdata$attendance)
  
  toursdata <- toursdata %>%
    arrange(desc(shows))

head(toursdata, n=10)
  
```

It looks like a tie between the 1990 Fall European Tour and the 1995 Spring/Summer European Tour, each with 58 shows. On the 1990 Fall European Tour the 58 shows were played in 67 days, compared to 71 days for the 1995 Spring/Summer European Tour. Did the 1995 tour cover a longer distance? Let's have a look at the number of shows in each country on each of those tours. 

```{r}

mydf <- othervariables %>% group_by(tour, country) %>% summarise(shows = n()) %>% ungroup()

mydf2 <- mydf %>% filter(tour=="1990 Fall European Tour" | tour == "1995 Spring/Summer European Tour") %>% pivot_wider(names_from = tour, values_from = shows)

mydf2[is.na(mydf2)] <- 0

mydf2
```
The 1995 tour included visits to 17 countries compared to only 16 in the 1990 tour. In 1995 Fugazi skipped Sweden and Poland but added visits to Finland, the Czech Republic and Portugal. The 1995 tour almost certainly covered a longer distance which probably explains why a few more days were required to complete it. 

## Leads and lags

Most Fugazi songs were performed live for some time before being released on an album or EP. These lead times were often very considerable, measured in months or years. Were there any exceptions, songs whose live launch dates lagged behind the corresponding release dates? To find out, let's start by getting the data on the releases and the corresponding release dates. 

```{r}
releasedates <- releasesdatalookup %>% 
  select(releaseid, releasedate) %>%
  mutate(releasedate = as.Date(releasedate, "%d/%m/%Y"))

mydf <- songvarslookup %>% 
  left_join(releasedates) %>%
  left_join(songidlookup)
mydf <- mydf %>% 
  select(songid, song, releaseid, releasedate) %>%
  arrange(songid)
head(mydf)

```
Now let's calculate leads and lags by getting summary data on the songs and comparing the song launch dates to the corresponding release dates.  

```{r}
mysummary <- Repeatr::summary %>% 
  left_join(mydf) %>%
  mutate(lead = releasedate - launchdate) %>%
  select(song, launchdate, releasedate, lead) %>%
  arrange(lead)

head(mysummary, n = 10)
```

Surprisingly, there seem to be only 2 songs whose live debuts lagged behind the corresponding release dates: Styrofoam which was first played live 58 days after the launch of Repeater, and Foreman's Dog which was first played live 4 days after the launch of End Hits. What was the average lead time for all Fugazi songs with a corresponding release?

```{r}
mean(mysummary$lead)
```
That is over 2 years, but perhaps the mean is biased upwards by a few extreme values... 

```{r}
mysummary <- mysummary %>%
  select(song, launchdate, releasedate, lead) %>%
  arrange(desc(lead))

head(mysummary, n = 10)
```
The median lead time is probably a more reliable indicator for how long Fugazi would tend to play a song live before it featuring on a discographical release.  

```{r}
median(mysummary$lead)
```
We have discovered several interesting things: 

1) Styrofoam was the only Fugazi song whose live debut significantly lagged behind the corresponding release, although the live debut of Foreman's Dog was 4 days after the release of End Hits.   

2) The median lead time for the live performance of a Fugazi song ahead of its corresponding discographical release date was approximately 1 year: 360 days. 

